<?xml version="1.0"?>
<project default="core"  basedir=".">

  <!-- set global properties for this build -->
  <property file="build.properties"/>
  <property name="filterFile" value="filter.properties"/>
  <property file="${filterFile}"/>
  <property name="dist" value="../../../dist" />
  <property name="web" value="../" />
  <property name="WebContent" value="../.." />

	<!--
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
	  <classpath>
	    <pathelement location="${WebContent}/WEB-INF/lib/ant-contrib-0.6.jar" />
	  </classpath>
	</taskdef>
	-->
  
  <!-- target INIT --> 
  <target name="init">
    <!-- Deletes the distribution directory -->
    <delete dir="${dist}"/>
    <!-- Create the dist directory structure used by compile
         and copy the deployment descriptors into it-->
    <mkdir dir="${dist}"/>
    <mkdir dir="${dist}/WEB-INF"/>
    <mkdir dir="${dist}/WEB-INF/classes"/>
    <mkdir dir="${dist}/WEB-INF/lib"/>
  	
  	<!-- Copia os jsps para o dir base -->
    <copy todir="${dist}">
      <fileset dir="${WebContent}">
        <include name="**/*.*"/>
      	<exclude name="WEB-INF/build/*"/>
      </fileset>
    </copy>  
  	
    <copy todir="${dist}">
      <fileset dir="${web}">
        <include name="**/*.*"/>
        <exclude name="**/jsp_servlet/*.class"/>
        <exclude name="**/build.xml"/>
        <exclude name="**/build.properties"/>
        <exclude name="**/servers.xml"/>
        <exclude name="**/targets.xml"/>
        <exclude name="**/*.war"/>
      </fileset>
    </copy>
  	
  	<!-- Copia para o dir WEB-INF/classes -->
    <copy todir="${dist}/WEB-INF/classes">
      <fileset dir="${build}">
        <include name="**/*.*"/>
        <exclude name="**/jsp_servlet/*.class"/>
      </fileset>
    </copy>	
    
  </target>

  <!-- DEPLOY -->
  <target name="lps" depends="undeploy,init" >

    <delete file="${war}.war"/>
  	<delete verbose="true" dir="${dist}/classes"/>
  	<!--
	<jar jarfile="${war}.war" basedir="${dist}"/>    
  	<copy file="${war}.war" todir="${domain}"/>
  	<delete file="${war}.war"/>
  	-->
  	
  	<!-- Conditions dos models do hibernate -->
	<condition property="relacionamento.persistence.class" else="">
		<isset property="relacionamento.persistence.class"/>
	</condition>
  	
	<condition property="seguranca.persistence.class" else="">
		<isset property="seguranca.persistence.class"/>
	</condition>
  	
	<condition property="monitoracao.persistence.class" else="">
		<isset property="monitoracao.persistence.class"/>
	</condition>

  	<filter filtersfile="${filterFile}"/>
  	<filter token="relacionamento.persistence.class" value="${relacionamento.persistence.class}"/>
  	<filter token="seguranca.persistence.class" value="${seguranca.persistence.class}"/>
  	<filter token="monitoracao.persistence.class" value="${monitoracao.persistence.class}"/>

  	<!--
  	<echo message="relacionamento.persistence.class: ${relacionamento.persistence.class}"/>
  	<echo message="seguranca.persistence.class: ${seguranca.persistence.class}"/>
  	<echo message="monitoracao.persistence.class: ${monitoracao.persistence.class}"/>
  	<echo message="Monitoracao: ${monitoracao}"/>
  	<echo message="Seguranca: ${seguranca}"/>
  	<echo message="Relacionamento: ${relacionamento}"/>
  	-->
  	
    <copy todir="${domain}/${war}" filtering="true">
      <fileset dir="${dist}">
        <include name="**/*.xml"/>
      	<include name="**/*.properties"/>
      </fileset>
    </copy>
  	
    <copy todir="${domain}/${war}">
      <fileset dir="${dist}">
        <include name="**/*.*"/>
        <exclude name="**/*.xml"/>
      	<exclude name="**/*.properties"/>
      	<exclude name="classes/*"/>
      	<exclude name="lib/*"/>
      	<exclude name="build/*"/>
      	<exclude name="seguranca/*"/>
      	<exclude name="monitoracao/*"/>
      	<exclude name="relacionamento/*"/>
      	<exclude name="WEB-INF/classes/com/pss/features/ativos/relacionamento/**/*.*"/>
      	<exclude name="WEB-INF/classes/com/pss/features/seguranca/**/*.*"/>
      	<exclude name="WEB-INF/classes/com/pss/features/monitoracao/**/*.*"/>
      </fileset>
    </copy>
  </target>


  <target name="seguranca" depends="lps" if="seguranca">

    <delete file="${war}.war"/>
  	<delete verbose="true" dir="${dist}/classes"/>

    <copy todir="${domain}/${war}" filtering="true">
      <fileset dir="${dist}">
        <include name="**/*.xml"/>
      	<include name="**/*.properties"/>
      </fileset>
    </copy>
      		
    <copy todir="${domain}/${war}">
      <fileset dir="${dist}">
        <exclude name="**/*.xml"/>
      	<exclude name="**/*.properties"/>      	
        <include name="seguranca/**/*.*"/>
      	<include name="WEB-INF/classes/com/pss/features/seguranca/**/*.*"/>
      </fileset>
    </copy>
  	
  </target>

  <target name="relacionamento" depends="lps" if="relacionamento">

    <delete file="${war}.war"/>
  	<delete verbose="true" dir="${dist}/classes"/>

    <copy todir="${domain}/${war}" filtering="true">
      <fileset dir="${dist}">
        <include name="**/*.xml"/>
      	<include name="**/*.properties"/>
      </fileset>
    </copy>
    	
    <copy todir="${domain}/${war}">
      <fileset dir="${dist}">
        <exclude name="**/*.xml"/>
      	<exclude name="**/*.properties"/>
        <include name="relacionamento/**/*.*"/>
      	<include name="WEB-INF/classes/com/pss/features/ativos/relacionamento/**/*.*"/>
      </fileset>
    </copy>
  	
  </target>

  <target name="monitoracao" depends="lps" if="monitoracao">

    <delete file="${war}.war"/>
  	<delete verbose="true" dir="${dist}/classes"/>

    <copy todir="${domain}/${war}" filtering="true">
      <fileset dir="${dist}">
        <include name="**/*.xml"/>
      	<include name="**/*.properties"/>
      </fileset>
    </copy>
  	
    <copy todir="${domain}/${war}">
      <fileset dir="${dist}">
        <exclude name="**/*.xml"/>
      	<exclude name="**/*.properties"/>
        <include name="monitoracao/**/*.*"/>
      	<include name="WEB-INF/classes/com/pss/features/monitoracao/**/*.*"/>
      </fileset>
    </copy>
  	
  </target>	

  <target name="core" depends="seguranca, monitoracao, relacionamento">
  
  </target>

  <target name="undeploy">
    <!-- Create the distribution directory -->
   <!--delete file="${domain}/${war}.war"/-->
 
  <!-- Tomcat -->
  <delete dir="${domain}/${war}"/>
  <!-- Tomcat 4.0.x-->
  <!-- delete dir="${serverhome}/work/localhost/${war}"/ -->
  <!-- Tomcat 4.1.x-->
  <!-- delete dir="${serverhome}/work/Standalone/localhost/${war}"/-->

  </target>
  
</project>
